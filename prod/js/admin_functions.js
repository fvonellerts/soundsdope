function queuewait(e){if(queue>0){queue-=1;var a=notyfication("information","Download from "+e+" in progress...");upload_megaurl(e,a)}else setTimeout(function(){queuewait(e)},100)}function validate_megaurl(e){e=$.trim(e);var a=e.split("!");return"https://mega.nz/#"!==a[0]?!1:8!==a[1].length?!1:43!==a[2].length?!1:!0}function upload_megaurl(e,a){$.ajax({method:"POST",url:"php/upload/ajax_file.php",data:{mega_url:e}}).done(function(e){queue+=1,a.close(),ajax_complete(e)})}function ajax_complete(e){var a=JSON.parse(e);if("error"==a.state){var i="";switch(a.type){case"invalid_id":i="Album ID is missing or invalid. This should not happen unless you messed around with the DOM.";break;case"upload_noname":i="The filename is missing or invalid.";break;case"upload_error":i="Something went wrong with the upload. Check your internet connection.";break;case"upload_mime":i="Invalid format. Use MP3 for audio and JPG/PNG/GIF for images.";break;case"upload_ext":i="Invalid format. Use MP3 for audio and JPG/PNG/GIF for images.";break;case"upload_size":i="The supplied file's size is over 50MB or under 10KB.";break;case"invalid_sql":i="An internal server error happened while connecting to the database.";break;case"invalid_image":i="Invalid image. It may be corrupted.";break;case"invalid_delete":i="An internal server error happened while deleting.";break;case"invalid_file":i="Invalid file. It may be corrupted.";break;case"invalid_editchange":i="Invalid value for this field.";break;case"invalid_edittype":i="Invalid field."}notyfication("error",i)}else"success"==a.state&&("image"==a.type?(notyfication("success","The cover image has been set."),$("#cover").attr("src","php/stream/image.php?id="+a.id)):"audio"==a.type?(notyfication("success",a.name+" has been added to the database."),$("#track_placeholder").remove(),$("<li/>").data("id",a.id).html('<div class="playing"><input placeholder="'+a.track+'" value="'+a.track+'"/></div><div class="title"><input placeholder="'+a.name+'" value="'+a.name+'"/></div><div class="duration"><input placeholder="'+a.playtime+'" value="'+a.playtime+'"/></div>').appendTo("#tracklist")):"delete_track"==a.type?(notyfication("warning","Track has been removed from the database."),$('*[data-id="'+a.id+'"]').remove(),$.trim($("#tracklist").html())||$("#tracklist").append('<li id="track_placeholder"><div class="playing"></div><div class="title">No title found</div><div class="duration"></div></li>')):"delete_album"==a.type?window.location="upload.php":"edit_track"==a.type?notyfication("success","Change has been saved."):"admin_album"==a.type&&(window.location="index.php"))}function delete_album(){$.ajax({method:"POST",url:"php/upload/ajax_remove.php",data:{action:"delete"}}).done(function(e){ajax_complete(e)})}function rightclick_action_admin(e){switch(remove_rightclick(),e){case"edit_remove":$.ajax({method:"POST",url:"php/upload/ajax_remove.php",data:{trackid:$rc_referer.data("id")}}).done(function(e){ajax_complete(e)});break;case"edit_coverupload":$("#upload_file").click();break;case"edit_coverdownload":var a=prompt("Please enter an image URL:");$.ajax({method:"POST",url:"php/upload/ajax_image.php",data:{cover_url:a}}).done(function(e){ajax_complete(e)})}}function confirm_upload(){return"img/placeholder.jpg"===$("#cover").attr("src")?(notyfication("warning","Cover image missing! Add one by rightclicking the placeholder image."),!1):$("#track_placeholder").length>0?(notyfication("warning","Songs missing! Upload at least one by pasting a MEGA link into the textfield."),!1):void(window.location="upload.php?step=verif")}function admin_album_remove(){$.ajax({method:"POST",url:"admin/ajax_remove.php"}).done(function(e){ajax_complete(e)})}function admin_album_verify(){$.ajax({method:"POST",url:"admin/ajax_verify.php"}).done(function(e){ajax_complete(e)})}function admin_hide_verified(){notyfication("success","Verified albums removed..."),$('*[data-verified="1"]').remove()}function admin_play(e){notyfication("success","Loading audio with identifier "+e+"...");var a=document.getElementById("audio_player"),i="admin/admin_audio.php?id="+e;a.setAttribute("src",i),a.load()}function notyfication(e,a){switch(e){case"success":var i=noty({text:a,layout:"topRight",theme:"relax",timeout:2e3,type:e});break;case"warning":var i=noty({text:a,layout:"topRight",theme:"relax",timeout:4e3,type:e});break;default:var i=noty({text:a,layout:"topRight",theme:"relax",type:e})}return i}function notyconfirm(e,a){noty({layout:"topRight",theme:"relax",type:"warning",text:e,buttons:[{text:"Cancel",onClick:function(e){e.close()}},{text:"Yes",onClick:function(e){e.close(),window[a]()}}]})}var queue=2;$("#paste").bind("paste",function(e){if(e.preventDefault(),e.originalEvent.clipboardData){var a=$.trim(e.originalEvent.clipboardData.getData("text/plain")),i=a.split(" ");notyfication("success","Starting "+queue+" downloads, "+(i.length-queue)+" links queued."),$.each(i,function(e,a){validate_megaurl(a)?queuewait(a):notyfication("warning","Invalid link! ("+a+")")})}}),$("#cover").click(function(){$("#upload_file").click()}),$("#cancel").click(function(){notyconfirm("Are you sure you want to cancel and delete everything?","delete_album")}),$("#confirm").click(function(){notyconfirm("Are you sure all fields are filled out? We only verify complete uploads!","confirm_upload")}),$("#admin_album_remove").click(function(){notyconfirm("Are you sure to delete this album?","admin_album_remove")}),$("#admin_album_verify").click(function(){notyconfirm("Are you sure to verify this album?","admin_album_verify")}),$("#admin_hide_verified").click(function(){admin_hide_verified()}),$("#upload_file").change(function(){for(var e=this.files.length,a=0;e>a;a++){var i=this.files[a];if(name=i.name,size=i.size,type=i.type,i.name.length<1);else{var t=new FormData;t.append("file",$("#upload_file")[0].files[a]),$.ajax({url:"php/upload/ajax_image.php",type:"POST",success:completeHandler=function(e){ajax_complete(e)},error:errorHandler=function(e,a,i){notyfication("error","General error! "+a+" / "+i)},data:t,cache:!1,contentType:!1,processData:!1},"json")}}}),$(document).on("contextmenu","#tracklist > li",function(e){return $rc_referer=$(this),rightclick_popup(e,"edit_track"),!1}),$(document).on("keypress","#tracklist > li input",function(e){if(13===e.which){var a=$(this).attr("placeholder"),i=$(this).val(),t=$(this).parent().attr("class"),n=$(this).parents("li").data("id");$.ajax({method:"POST",url:"php/upload/ajax_edit.php",data:{trackid:n,type:t,change:i}}).done(function(e){var t=JSON.parse(e);"error"==t.state?(notyfication("error","Error changing value."),$(this).val(a)):$(this).attr("placeholder",i),ajax_complete(e)})}});