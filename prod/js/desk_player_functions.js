function track_preload(a){$("#player_info").data("next-song-id",a),$.ajax({dataType:"json",method:"POST",url:"php/filter/filter.php",data:{track:a}}).done(function(t){console.log(t),json_errorcheck(t);var i=t[0];if($("#play_forward_info").html(i.name),$("#play_forward_info").addClass("active"),globals_preload){var l="php/stream/audio.php?id="+a;audio_inactive.setAttribute("src",l),audio_inactive.load()}})}function skip_forward(){$("#player_info").data("last-song-id",$("#player_info").data("song-id")),$("#player_info").data("song-id",$("#player_info").data("next-song-id")),globals_preload?(audio_active==audio?(audio_active=audio2,audio_inactive=audio):(audio_active=audio,audio_inactive=audio2),audio_active.play(),preloaded?(loaded(),preloaded=!1):loading(),track_play_ui($("#player_info").data("song-id"))):track_play($("#player_info").data("song-id"))}function track_next(){$("#play_forward_info").removeClass("active");var a=JSON.parse($("#playlist_content").data("playlist"));2===globals_repeat?track_preload($("#player_info").data("song-id")):a.playlist.length>0?skip_playlist_forward():skip_autoplay(globals_random?"random":"forward")}function skip_backward(){if($("#player_info").data("last-song-id")!==$("#player_info").data("song-id"))track_play($("#player_info").data("last-song-id")),$("#player_info").data("last-song-id","");else{var a=JSON.parse($("#playlist_content").data("playlist"));2===globals_repeat?track_preload($("#player_info").data("song-id")):a.playlist.length>0?skip_playlist_backward():globals_random?$.ajax({dataType:"json",method:"POST",url:"php/filter/skip.php",data:{id:$("#player_info").data("song-id"),direction:"random"}}).done(function(a){json_errorcheck(a),track_play(a[0].id)}):$.ajax({dataType:"json",method:"POST",url:"php/filter/skip.php",data:{id:$("#player_info").data("song-id"),direction:"backward"}}).done(function(a){json_errorcheck(a),track_play(a[0].id)})}}function skip_autoplay(a){$.ajax({dataType:"json",method:"POST",url:"php/filter/skip.php",data:{id:$("#player_info").data("song-id"),direction:a}}).done(function(a){json_errorcheck(a),track_preload(a[0].id)})}function skip_playlist_forward(){var a=$("#player_info").data("song-id"),t=JSON.parse($("#playlist_content").data("playlist")),i=!1,l=t.playlist.length;$.each(t.playlist,function(e,o){if(o.song_id===a)if(globals_random){i=!0;for(var n=Math.floor(Math.random()*l);n==e;)n=Math.floor(Math.random()*l);track_preload(t.playlist[n].song_id)}else l>e+1?(track_preload(t.playlist[e+1].song_id),i=!0):1==globals_repeat&&(track_preload(t.playlist[0].song_id),i=!0)}),i||skip_autoplay("forward")}function skip_playlist_backward(){var a=$("#player_info").data("song-id"),t=JSON.parse($("#playlist_content").data("playlist")),i=!1,l=t.playlist.length;return $.each(t.playlist,function(e,o){if(o.song_id===a)if(globals_random){i=!0;for(var n=Math.floor(Math.random()*l);n==e;)n=Math.floor(Math.random()*l);track_play(t.playlist[n].song_id)}else e+1>1?(track_play(t.playlist[e-1].song_id),i=!0):1==globals_repeat&&(track_play(t.playlist[l-1].song_id),i=!0)}),i?void 0:skip_autoplay("backward")}function track_play(a){$("#player_info").data("song-id",a),$("#play_forward_info").removeClass("active");var t="php/stream/audio.php?id="+a;audio.setAttribute("src",t),audio.load(),audio.play(),audio_active=audio,audio_inactive=audio2,audio_inactive.pause(),loading(),track_play_ui(a)}function switch_play(){audio_active.paused?(audio_active.play(),$("#play_stop").css("display","block"),$("#play_play").css("display","none")):(audio_active.pause(),$("#play_stop").css("display","none"),$("#play_play").css("display","block"))}function track_play_ui(a){playing(),autoseek(0),$.ajax({dataType:"json",method:"POST",url:"php/filter/filter.php",data:{track:a}}).done(function(a){json_errorcheck(a);var t=a[0];if($("#player_info").data("id",t.id),$("#play_slider_maxtime").text(t.playtime),$("#play_slider_maxtime").data("seconds",convert_playtime(t.playtime)),$("#player_info_cover").attr("src")!=="php/stream/image.php?id="+t.id)$("#player_info_cover").fadeOut(500).promise().done(function(){$("#player_info_cover").attr("src","php/stream/image.php?id="+t.id),$("#player_info_cover").fadeTo(1800,1),$("#player_info_artist").html(t.artist),$("#player_info_albumname").html(t.title),$("#player_info_trackname").html(t.name);var a=document.createElement("textarea");a.innerHTML=t.artist+" - "+t.name,document.title=a.value,$("#play_stop").css("display","block"),$("#play_play").css("display","none")});else{$("#player_info_artist").html(t.artist),$("#player_info_albumname").html(t.title),$("#player_info_trackname").html(t.name);var i=document.createElement("textarea");i.innerHTML=t.artist+" - "+t.name,document.title=i.value,$("#play_stop").css("display","block"),$("#play_play").css("display","none")}})}function playing(){$("#album_content > li .playing, #playlist_content .albumview > li .playing").removeClass("active"),$("#album_content > li, #playlist_content .albumview > li").filter(function(){return $(this).data("song-id")==$("#player_info").data("song-id")}).find(".playing").addClass("active")}function loading(){$(".loader").fadeIn("slow")}function loaded(){$(".loader").fadeOut("slow"),track_next()}function convert_playtime(a){var t=a.split(":"),i=60*parseInt(t[0])+parseInt(t[1]);return i}function convert_back_playtime(a){var t=Math.floor(a/60),i=Math.floor(a%60);return 10>i&&(i="0"+i),t+":"+i}function seek(a){$("#play_slider").css("width",a+"%");var t=$("#play_slider_maxtime").data("seconds")/100,i=t*a;audio.currentTime=i,$("#play_slider_time").text(convert_back_playtime(i))}function autoseek(a){var t=$("#play_slider_maxtime").data("seconds"),i=100*a/t;$("#play_slider").css("width",i+"%"),$("#play_slider_time").text(convert_back_playtime(a))}function playlist_track_add(a){var t=JSON.parse($("#playlist_content").data("playlist"));0==t.playlist.length&&($("#playlist_content").empty(),screenup("playlist")),audio.paused&&track_play(a),$.ajax({async:!1,method:"POST",url:"php/filter/filter.php",data:{track:a}}).done(function(i){var l=JSON.parse(i);$.each(l,function(i,l){t.playlist.push({album_id:l.id,song_id:a}),$("#playlist_content").data("playlist",JSON.stringify(t)),playlist_track_add_ui(a,l)})})}function playlist_track_add_ui(a,t){hide_placeholder(2);var i='<li data-song-id="'+a+'"><div class="playing">'+t.track+'</div><div class="title">'+t.name+'</div><div class="rc" data-action="playlist_track"><i class="material-icons">more_horiz</i></div><div class="duration">'+t.playtime+"</div></li>";$("#playlist_content > li").last().find(".coverview").data("id")==t.id?$("#playlist_content > li").last().find(".albumview").append(i):$("#playlist_content").append("<li><div style=\"background-image:url('php/stream/image.php?id="+t.id+'\');" data-id="'+t.id+'" class="coverview"><div class="infos"><div id="playlist_info_albumname" class="field2">'+t.title+'</div><div id="playlist_info_artist" class="field1">'+t.artist+'</div><span class="rc" data-action="playlist_album"><i class="material-icons">more_horiz</i></span></div></div><ul class="albumview">'+i+"</ul></li>"),playlist_count(),playing()}function playlist_track_remove(){var a=JSON.parse($("#playlist_content").data("playlist")),t=$("#playlist_content li li").index($rc_referer);$rc_referer.siblings("li").length<1?($rc_referer.parents("li").remove(),$.trim($("#playlist_content").html())||playlist_clear()):$rc_referer.remove(),a.playlist.splice(t,1),$("#playlist_content").data("playlist",JSON.stringify(a)),playlist_count()}function playlist_album_remove(){var a=JSON.parse($("#playlist_content").data("playlist")),t=$rc_referer.siblings(".albumview").find("li:first-child"),i=$rc_referer.siblings(".albumview").find("li:last-child"),l=$("#playlist_content li li").index(t),e=$("#playlist_content li li").index(i);$rc_referer.parents("li").remove(),$.trim($("#playlist_content").html())||playlist_clear(),a.playlist.splice(l,e-l),$("#playlist_content").data("playlist",JSON.stringify(a)),playlist_count()}function playlist_clear(){var a={},t=[];a.playlist=t,$("#playlist_content").data("playlist",JSON.stringify(a)),$("#playlist_content").empty(),show_placeholder(5),playlist_count()}function playlist_count(){var a=JSON.parse($("#playlist_content").data("playlist"));0==a.playlist.length?$("#playlist_count").removeClass("active"):($("#playlist_count").addClass("active"),$("#playlist_count").text(a.playlist.length))}function playlist_save(){var a=JSON.parse($("#playlist_content").data("playlist")),t=JSON.stringify(a);if(0!==a.playlist.length){var i=[],l=0,e="";$.each(a.playlist,function(a,t){t.album_id!==e&&4!==l&&(e=t.album_id,i.push(t.album_id),l++)});var o=$("#save_name").val();if(""!==o){var n=ls_custom.get("soundsdope"),s={ids:i,title:o,playlist:t};n.playlists.push(s),ls_custom.set("soundsdope",JSON.stringify(n)),playlist_save_ui(i,o,t),extoolbar_close(),screenup("desk")}else notyfication("error","save_notitle")}}function playlist_delete(a){if(ls_custom.isSet("soundsdope")){var t=ls_custom.get("soundsdope"),i="";$.each(t.playlists,function(t,l){l.playlist==a&&(i=t)}),t.playlists.splice(i,1),ls_custom.set("soundsdope",JSON.stringify(t))}playlist_delete_ui(a)}function playlist_delete_ui(a){$("#desk_content li").filter(function(){$(this).data("playlist")==a&&$(this).remove()})}function playlist_rename(a){var t=prompt("Please enter a playlist title","");if(null!=t&&ls_custom.isSet("soundsdope")){var i=ls_custom.get("soundsdope");$.each(i.playlists,function(i,l){l.playlist==a&&(l.title=t)}),ls_custom.set("soundsdope",JSON.stringify(i)),playlist_rename_ui(a,t)}}function playlist_rename_ui(a,t){$("#desk_content li").filter(function(){$(this).data("playlist")==a&&$(this).find(".field2").text(t)})}function playlist_restore(){var a=$lc_referer.data("playlist"),t=JSON.parse(a);playlist_clear(),$.each(t.playlist,function(a,t){playlist_track_add(t.song_id)})}function playlist_combine(a){var t=JSON.parse(a);$.each(t.playlist,function(a,t){playlist_track_add(t.song_id)})}function volume_switch(){volume(0==$("#audio_player").data("volume")&&$("#audio_player").data("customvolume")>.9?1:0==$("#audio_player").data("volume")?$("#audio_player").data("customvolume"):0)}function volume(a){audio_player.volume=a,audio_player2.volume=a,1==a?$("#settings_volume i").text("volume_up"):0==a?$("#settings_volume i").text("volume_mute"):$("#settings_volume i").text("volume_down"),$("#settings_volume_slider").css("width",100*a+"%"),$("#audio_player").data("volume",a)}var audio=document.getElementById("audio_player"),audio2=document.getElementById("audio_player2"),audio_active,audio_inactive,preloaded=!1;$(function(){audio.onended=function(){skip_forward()},audio2.onended=function(){skip_forward()},audio.oncanplay=function(){audio==audio_active?loaded():preloaded=!0},audio2.oncanplay=function(){audio2==audio_active?loaded():preloaded=!0},audio.addEventListener("timeupdate",function(){audio==audio_active&&autoseek(audio.currentTime)}),audio2.addEventListener("timeupdate",function(){audio2==audio_active&&autoseek(audio2.currentTime)}),$("#audio_player").data("customvolume",1)}),$("#play_slider_bar").click(function(a){percentage=100*((a.pageX-$("#play_slider_bar")[0].offsetLeft)/$("#play_slider_bar").width()),seek(percentage)}),$("#settings_volume_bar").click(function(a){percentage=(a.pageX-$("#settings_volume_bar")[0].offsetLeft)/$("#settings_volume_bar").width(),$("#audio_player").data("customvolume",percentage),volume(percentage)}),$("#play_slider_bar").click(function(a){var t=$("#play_slider_bar").width()/100,i=a.pageX-$(this).position().left,l=i/t;seek(l)}),$("#play_play, #play_stop").click(function(){switch_play()}),$("#play_back").click(function(){skip_backward()}),$("#play_forward").click(function(){skip_forward()}),$("#playlist_clear").click(function(){playlist_clear()}),$("#playlist_save").click(function(){playlist_save()}),$("#playlist_download").click(function(){playlist_download()}),$("#playlist_share").click(function(){playlist_share()}),$("#settings_volume").click(function(a){volume_switch()}),$(document).on("contextmenu","#playlist_content .albumview > li",function(a){return $rc_referer=$(this),rightclick_popup(a,"playlist_track"),!1}),$(document).on("contextmenu","#playlist_content .coverview",function(a){return $rc_referer=$(this),rightclick_popup(a,"playlist_album"),!1}),$(document).on("click","#playlist_content .coverview",function(a){album_popup2($(this).data("id"))});